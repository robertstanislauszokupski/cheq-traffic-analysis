# Advanced Analysis Features - Quick Reference

This document provides a quick reference for the new advanced analysis features added to the CHEQ interview project.

## New Files Created

### Scripts
1. **cost_calculator.py** - Interactive ROI calculator
2. **export_advanced.py** - Generates 4 advanced analysis CSV files

### SQL Queries (added to 03_analysis.sql)
3. **Query 6** - ASN/ISP Analysis
4. **Query 7** - User Agent Analysis  
5. **Query 8** - Hourly Pattern Analysis
6. **Query 9** - Daily Pattern Analysis

### CSV Outputs
7. **asn_analysis.csv** - Top 30 ASNs by invalid traffic
8. **user_agent_analysis.csv** - Browser/bot detection patterns
9. **hourly_patterns.csv** - Attack timing by hour (24-hour)
10. **daily_patterns.csv** - Day-over-day trends
11. **roi_analysis.csv** - Cost calculator export (generated on demand)

---

## Usage Instructions

### 1. Generate All Advanced Reports
```bash
python export_advanced.py
```

**Output:**
- Creates 4 CSV files in outputs/ directory
- Shows summary statistics:
  - Top threat ASN
  - Most common automation tool
  - Peak attack hour

### 2. Calculate ROI
```bash
python cost_calculator.py
```

**Interactive prompts:**
1. Google Ads average CPC (e.g., 2.50)
2. Bing Ads average CPC (e.g., 1.80)
3. CHEQ monthly cost (e.g., 2500)
4. Trial period length in days (default 31)

**Outputs:**
- Wasted ad spend by channel
- Monthly and annual savings projections
- ROI percentage
- Payback period in days
- Option to export to CSV

---

## Key Insights from Advanced Analysis

### ASN Analysis
- **AS-CHOOPA (Vultr)**: 9,561 invalid events (100% invalid)
- **AS-BLAZINGSEO**: 8,243 invalid events (100% invalid)
- **AMAZON-02**: 3,024 events (99.97% invalid)

**Recommendation:** These are hosting providers commonly used for bot farms. Consider blocking or rate-limiting.

### User Agent Analysis
- **Firefox**: 65.51% invalid rate (4,407 of 6,727)
- **Chrome**: 25.63% invalid rate (25,547 of 99,691)
- **Headless Chrome**: 67 instances detected (100% invalid)
- **PhantomJS**: 1 instance (100% invalid)

**Recommendation:** Firefox traffic may be bot impersonation. Implement additional validation.

### Time Pattern Analysis

**Hourly:**
- Hours 20-23 UTC show ~10,400 events each (3x normal)
- Peak invalid hour: 22:00 UTC (2,537 invalid)
- Baseline hours: ~4,000 events/hour

**Daily:**
- July 14: 90,816 events (5.34% invalid) - normal operations
- July 5: 5,000 events (89.74% invalid) - major attack
- July 12: 3,766 events (85.48% invalid) - attack day

**Recommendation:** Investigate coordinated bot activity during 20-23 UTC window.

---

## Demo Scenarios

### Scenario 1: Present ROI to stakeholders
```bash
python cost_calculator.py
# Input realistic CPC values
# Screenshot or export results
# Include in presentation deck
```

### Scenario 2: Identify bot infrastructure
```bash
python export_advanced.py
# Review asn_analysis.csv
# Identify hosting providers
# Recommend IP blocking rules
```

### Scenario 3: Detect attack patterns
```bash
python export_advanced.py
# Review hourly_patterns.csv and daily_patterns.csv
# Identify anomalous spikes
# Recommend enhanced monitoring during high-risk hours
```

---

## Technical Notes

### Timestamp Parsing
The dataset uses non-standard timestamp format: `M/D/YY H:MM`

The queries use SQLite string functions:
```sql
-- Extract hour (handles both "19:51" and "3:29")
CAST(substr(timestamp, instr(timestamp, ' ') + 1, 2) AS INTEGER)

-- Extract date
substr(timestamp, 1, instr(timestamp, ' ') - 1)
```

### Empty String Handling
All queries check for both NULL and empty strings:
```sql
WHERE reason_threat_group IS NOT NULL AND reason_threat_group != ''
```

This is critical since clean events have empty strings, not NULL values.

---

## File Locations

All outputs are in the `outputs/` directory:
```
outputs/
├── paid_traffic_summary.csv      # Core analysis
├── funnel_threats.csv            # Core analysis
├── threat_taxonomy.csv           # Core analysis
├── asn_analysis.csv              # Advanced: ISP analysis
├── user_agent_analysis.csv       # Advanced: Bot detection
├── hourly_patterns.csv           # Advanced: Attack timing
├── daily_patterns.csv            # Advanced: Daily trends
└── roi_analysis.csv              # Generated by cost_calculator.py
```

---

*This document was created as part of the advanced analysis enhancement for the CHEQ interview project.*
